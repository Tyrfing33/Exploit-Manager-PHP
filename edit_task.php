<!-- Page d'édition de tâche-->
<?php	
	include('pattern/connexion_mysql.php');
	include('class/tasks.php');
	#Si la tâche a été modifiée :
	if (isset($_POST['nom']))
	{
		$task = new Task($_POST['nom'], $_POST['process'], $_POST['fichier'], $_POST['heure'], $_POST['jour'], $_POST['action'], $_POST['equipe'], $_POST['ferie'], $_POST['deleted']);
		$task->EditTask($bdd);
		header('Location:gestion_dayh.php');
	}	
	#Si la tâche n'a pas été modifiée, j'affiche ses données.
	$result = $bdd->query("SELECT * FROM scheduled_tasks WHERE Task_ID ='".$_GET['id_task']."'");
	$result->execute();	
	$result_team = $bdd->query("SELECT * FROM equipe");
	$result_team->execute();
	while($donnees=$result->fetch())
	{
		$name = $donnees['Task_Name'];
		$action = $donnees['Task_Action'];
		$id = $donnees['Task_ID'];
		$listday = $donnees['Task_Day'];
		$team = $donnees['Task_EquipeID'];
		$file = $donnees['Task_File'];
		$heure = $donnees['Task_Hour'];
		$process = $donnees['Task_Process'];
		$ferie = $donnees['Task_PublicHoliday'];
		$deleted = $donnees['Deleted'];
	}
	echo '<script type="text/javascript">
	function redirection()
	{
		window.location= "del_task.php?task_id='.$id.'";
	}
	</script>'
?>

<!DOCTYPE html>
<head>
	<title> Gestion Exploitation - Edition tâche </title>
</head>


<body>
	<?php
		echo "<TD><button type=\"button\" onclick=\"self.location.href='gestion_tasks.php'\">
		Retour
		</button></TD>";
	?>
	<!-- Formulaire de données de la tâche -->
	<h1>Edition de la tâche <?php echo $name;?> </h1>
	<form method='POST' action='add_task.php'>
		<label>Nom de la tâche</label><br/>
		<input type="text" name="nom" size="30" required="required" value="<?php echo $name;?>"/><br/>
		<label>Action de la tâche</label><br/>
		<input type="text" name="action" size="30" required="required" value="<?php echo $action;?>"/><br/>
		<label> Fichier de procédure (Rentrer le chemin à la main)</label><br/>
		<input type="text" name="process" size="100" value="<?php echo $process;?>"/><br/>
		<label> Fichier à saisir (Rentrer le chemin à la main)<label><br/>
		<input type="text" name="fichier" size="100" value="<?php echo $file;?>"/><br/>
		<label>Equipe assignée</label><br/>
		<select name="equipe[]" multiple size="5" required="required" value="<?php echo $team;?>"/><br/>
			<?php
			while($donnees_team=$result_team->fetch())
			{
				if ($donnees_team['Equipe_ID'] == $team)
				{
					echo "<option value=\"".$donnees_team['Equipe_ID']."\" selected=\"selected\">".$donnees_team['Equipe_Name']."</option>";
				}
				else
				{
					echo "<option value=\"".$donnees_team['Equipe_ID']."\">".$donnees_team['Equipe_Name']."</option>";
				}
			}
			
			?>
		</select><br/>
		<label>Heure de réalisation</label><br/>
		<input type="time" name="heure" required="required" value="<?php echo $heure;?>"/><br/>
		<label>Jour de réalisation</label><br/>
		<select name="jour[]" multiple size="5" required="required"/><br/>
			<option value="Lundi">Lundi</option>
			<option value="Mardi">Mardi</option>
			<option value="Mercredi">Mercredi</option>
			<option value="Jeudi">Jeudi</option>
			<option value="Vendredi">Vendredi</option>
			<option value="Samedi">Samedi</option>
			<option value="Dimanche">Dimanche</option>
		</select><br/>
		<label>Lancer les jours fériés ?</label><br/>
		<input type="checkbox" name="ferie" value="<?php echo $ferie;?>"></input></br>
		<label>Tâche désactivée</label><br/>
		<input type="checkbox" name="deleted" value="<?php echo $deleted;?>"></input></br>
		<input type="submit" value="Editer"></input>
	</form>
	<button type="button" onclick="redirection()" style="background-color:grey" style="color:white; font-weight:bold">
	Supprimer	
	</button>
</body>
</html>