<?php	
	session_start();	
	if (!isset($_SESSION['login'])) 
	{
		header("Location: connexion.php");
	}
?>
<!-- Page d'édition utilisateur -->
<?php	
	include('class/user.php');
	include('pattern/connexion_mysql.php');
	#Si l'utilisateur a été modifié :
	if (isset($_POST['login']))
	{
		#Je crée un objet User et j'utilise la méthode EditUser, puis je détruis l'objet et je redirige vers la gestion des utilisateurs
		$new_user = new User($_POST['login'], $_POST['prenom'], strtoupper($_POST['nom']), $_POST['equipe']);
		$new_user->EditUser($bdd);
		$new_user->__destruct();
		header('Location: gestion_user.php');
	}	
	#Si l'utilisateur n'a pas été modifié, j'affiche ses données.
	$result = $bdd->query("SELECT * FROM user WHERE User_Login ='".$_GET['user_login']."'");
	$result->execute();	
	while($donnees=$result->fetch())
	{
		$login = $donnees['User_Login'];
		$nom = $donnees['User_Name'];
		$prenom = $donnees['User_FirstName'];
		$team = $donnees['User_EquipeID'];
	}
	echo '<script type="text/javascript">
	function redirection()
	{
		window.location= "del_user.php?login='.$login.'";
	}
	</script>'
?>

<!DOCTYPE html>
<head>
	<title> Gestion Exploitation - Edition utilisateur </title>
</head>


<body>
	<?php
		echo "<TD><button type=\"button\" onclick=\"self.location.href='gestion_user.php'\">
		Retour
		</button></TD>";
	?>
	<!-- Formulaire de données de l'utilisateur -->
	<h1>Edition de l'utilisateur <?php echo $login;?> </h1>
	<form method="POST" action="edit_user.php">		
		<label>Prénom</label><br/>
		<input type="text" name="prenom" size="30" required="required" value="<?php echo $prenom?>"/><br/>
		<label>Nom</label><br/>
		<input type="text" name="nom" size="30" required="required" style="text-transform:uppercase;" value="<?php echo $nom?>"/><br/>
		<label>Login AD</label><br/>
		<input type="text" name="login" size="30" required="required" value="<?php echo $login?>"/><br/>
		<label>Equipe</label><br/>
		<select name="equipe" size="1" required="required"/><br/>
			<option value="1">H24</option>
			<option value="2">AS400</option>
			<option value="3">Exploitation</option>
		</select><br/>
		<input type="submit" value="Editer"></input>
	</form>
	<button type="button" onclick="redirection()" style=\"'background-color:grey\"' style=\"'color:white; font-weight:bold\"'>
	Supprimer	
	</button>
</body>
</html>
