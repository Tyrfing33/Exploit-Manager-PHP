<?php
	session_start();	
	echo "<p> Bonjour, ".$_SESSION["nom"]." ".$_SESSION["prenom"]."<p/>";
	echo "<p>Votre équipe : ".$_SESSION["equipe"]."</p>";		
?>

<?php
	$date = date("Y-m-d");
	include('pattern/connexion_mysql.php');
	$result = $bdd->prepare("SELECT * FROM work INNER JOIN scheduled_tasks ON Task_ID = Work_TaskID WHERE Task_EquipeID = ".$_SESSION["equipeID"]." AND Work_DayToRealise = '".$date."'");
	$result->execute();		
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Gestion Exploitation - Espace de travail</title>
</head>
<body>
	<div id="div_session">
		<form method="POST" action="connexion.php">
		<input type="submit" name="logout" value="Se déconnecter"/>
		</form>
		<?php
			#if ($_SESSION['teamleader'] == true)
			#{
				echo '<a href="backoffice.php">Gestion de l\'application</a>';
			#}
		?>
	</div>
	<div id="div_work">

		
		<h3> Travail à faire le <?php echo $date;?> </h3>
		<?php		
			
			echo "<table border=\"2\"><TR>";
			echo "<TH> Nom </TH>";
			echo "<TH> Action </TH>";
			echo "<TH> Heure </TH>";
			echo "<TH> Etat </TH>";	
			echo "<TH> Date </TH>";
			echo "<TH> Utilisateur </TH>";			
			echo "<TH> Détails </TH>";
			echo "</TR>";
			while ($donnees=$result->fetch())
			{
				echo "<TR>";
				echo "<TD>".$donnees['Task_Name']."</TD>";			
				echo "<TD>".$donnees['Task_Action']."</TD>";
				echo "<TD>".$donnees['Task_Hour']."</TD>";
				if ($donnees['Work_Realised'] == 1)
				{
					echo "<TD> Effectuée </TD>";	
				}
				else
				{
					echo "<TD> Non effectuée </TD>";
				}
				echo "<TD>".$donnees['Task_Day']."</TD>";
				echo "<TD>".$donnees['Work_DayToRealise']."</TD>";
				echo "<TD>".$donnees['Work_UserName']."</TD>";
				echo "<TD><button type=\"button\" onclick=\"self.location.href='details_task.php?id_task=".$donnees['Work_ID']."'\" style=\"background-color:grey\" style=\"color:white; font-weight:bold\">
				Détails
				</button></TD>";
				echo "</TR>";			
			}
			echo "</table>";
			$result->closeCursor();
	?>
	</div>
	
	<div id="div_ancientwork">
		<h3> Ancienne tâche non terminée </h3>
		<?php		
			$result2 = $bdd->prepare("SELECT * FROM work INNER JOIN scheduled_tasks ON Task_ID = Work_TaskID WHERE Work_Realised = 0 AND Task_EquipeID = ".$_SESSION["equipeID"]." AND Work_DayToRealise < '".$date."'");
			$result2->execute();
			echo "<table border=\"'2\"'><TR>";
			echo "<TH> Nom </TH>";
			echo "<TH> Action </TH>";
			echo "<TH> Heure </TH>";
			echo "<TH> Etat </TH>";
			echo "<TH> Date </TH>";
			echo "<TH> Utilisateur </TH>";
			echo "<TH> Détails </TH>";
			echo "</TR>";
			while ($donnees2=$result2->fetch())
			{
				echo "<TR>";
				echo "<TD>".$donnees2['Task_Name']."</TD>";			
				echo "<TD>".$donnees2['Task_Action']."</TD>";
				echo "<TD>".$donnees2['Task_Hour']."</TD>";
				if ($donnees2['Work_Realised'] == 1)
				{
					echo "<TD> Effectuée </TD>";	
				}
				else
				{
					echo "<TD> Non effectuée </TD>";
				}				
				echo "<TD>".$donnees2['Work_DayToRealise']."</TD>";
				echo "<TD>".$donnees2['Work_UserName']."</TD>";
				echo "<TD><button type=\"button\" onclick=\"self.location.href='details_task.php?id_task=".$donnees2['Work_ID']."'\" style=\"background-color:grey\" style=\"color:white; font-weight:bold\">
				Détails
				</button></TD>";
				echo "</TR>";			
			}
			echo "</table>";
			$result2->closeCursor();
		?>
	</div>
	
	<div id="div_actualwork">
		<h3> Tâche en cours pour l'utilisateur <?php echo $_SESSION['login'];?></h3>
		<?php		
			$result3 = $bdd->prepare("SELECT * FROM work INNER JOIN scheduled_tasks ON Task_ID = Work_TaskID WHERE Work_Realised = 0 AND Work_UserName = (SELECT User_ID FROM user WHERE User_Login = '".$_SESSION['login']."')");
			$result3->execute();
			echo "<table border=\"'2\"'><TR>";
			echo "<TH> Nom </TH>";
			echo "<TH> Action </TH>";
			echo "<TH> Heure </TH>";
			echo "<TH> Etat </TH>";
			echo "<TH> Date </TH>";
			echo "<TH> Utilisateur </TH>";
			echo "<TH> Détails </TH>";
			echo "</TR>";
			while ($donnees3=$result3->fetch())
			{
				echo "<TR>";
				echo "<TD>".$donnees3['Task_Name']."</TD>";			
				echo "<TD>".$donnees3['Task_Action']."</TD>";
				echo "<TD>".$donnees3['Task_Hour']."</TD>";
				if ($donnees3['Work_Realised'] == 1)
				{
					echo "<TD> Effectuée </TD>";	
				}
				else
				{
					echo "<TD> Non effectuée </TD>";
				}				
				echo "<TD>".$donnees3['Work_DayToRealise']."</TD>";
				echo "<TD>".$donnees3['Work_UserName']."</TD>";
				echo "<TD><button type=\"button\" onclick=\"self.location.href='details_task.php?id_task=".$donnees3['Work_ID']."'\" style=\"background-color:grey\" style=\"color:white; font-weight:bold\">
				Détails
				</button></TD>";
				echo "</TR>";			
			}
			echo "</table>";
			$result3->closeCursor();
		?>
	</div>
	
	<div id="div_finishedwork">
		<h3> Tâches du jour effectuées </h3>
		<?php		
			$result4 = $bdd->prepare("SELECT * FROM work INNER JOIN scheduled_tasks ON Task_ID = Work_TaskID WHERE Task_EquipeID = ".$_SESSION["equipeID"]." AND Work_Realised = 1 AND Work_DayToRealise = '".$date."'");
			$result4->execute();
			echo "<table border=\"'2\"'><TR>";
			echo "<TH> Nom </TH>";
			echo "<TH> Action </TH>";
			echo "<TH> Heure </TH>";
			echo "<TH> Etat </TH>";
			echo "<TH> Date </TH>";
			echo "<TH> Utilisateur </TH>";
			echo "<TH> Détails </TH>";
			echo "</TR>";
			while ($donnees4=$result4->fetch())
			{
				echo "<TR>";
				echo "<TD>".$donnees4['Task_Name']."</TD>";			
				echo "<TD>".$donnees4['Task_Action']."</TD>";
				echo "<TD>".$donnees4['Task_Hour']."</TD>";
				if ($donnees4['Work_Realised'] == 1)
				{
					echo "<TD> Effectuée </TD>";	
				}
				else
				{
					echo "<TD> Non effectuée </TD>";
				}				
				echo "<TD>".$donnees4['Work_DayToRealise']."</TD>";
				echo "<TD>".$donnees4['Work_UserName']."</TD>";
				echo "<TD><button type=\"button\" onclick=\"self.location.href='details_task.php?id_task=".$donnees4['Work_ID']."'\" style=\"background-color:grey\" style=\"color:white; font-weight:bold\">
				Détails
				</button></TD>";
				echo "</TR>";			
			}
			echo "</table>";
			$result4->closeCursor();
		?>
	</div>
	
	<a href="tasksearch.php">Recherche de tâches</a>
	
</body>
</html>
