<?php	
	session_start();	
	if (!isset($_SESSION['login'])) 
	{
		header("Location: connexion.php");
	}
?>
<!-- Page d'ajout des tâches -->
<?php
include('pattern/connexion_mysql.php');
include('class/tasks.php');
if (isset($_POST['nom']))
{
	$jour = implode($_POST['jour'], ",");
	$equipe = $_POST['equipe'];	
	if (!isset($_POST['ferie']))
	{
		$ferie = 0;
	}
	else if ($_POST['ferie'] == 'on')
	{
		$ferie = 1;
	}
	$task = new Task($_POST['nom'], $_POST['process'], $_POST['fichier'], $_POST['heure'], $jour, $_POST['action'], $equipe, $ferie, 0);
	$task->AddTask($bdd);
	$ajouthisto = $bdd->query("INSERT INTO histo (histo_Table, histo_NameElement, histo_Date, histo_User, histo_Type) VALUES ('task','".$_POST['nom']."',NOW(),'".$_SESSION['login']."',1)");		
	$task->__destruct();	
}
?>

<!DOCTYPE html>
<head>
<title> Gestion Exploitation - Ajout de tâche </title>
</head>
<body>
	<?php
		echo "<TD><button type=\"button\" onclick=\"self.location.href='gestion_tasks.php'\">
		Retour
		</button></TD>";
	?>
	<form method='POST' action='add_task.php'>
		<label>Nom de la tâche</label><br/>
		<input type="text" name="nom" size="30" required="required"/><br/>
		<label>Action de la tâche</label><br/>
		<input type="text" name="action" size="30" required="required"/><br/>
		<label> Fichier de procédure (Rentrer le chemin à la main)</label><br/>
		<input type="text" name="process" size="100"/><br/>
		<label> Fichier à saisir (Rentrer le chemin à la main)<label><br/>
		<input type="text" name="fichier" size="100"/><br/>
		<label>Equipe assignée</label><br/>
		<?php echo "<input type=\"text\" name=\"equipename\" value=\"".$_SESSION['equipe']."\"disabled/>";?><br/>
		<?php echo "<input type=\"hidden\" name=\"equipe\" value=\"".$_SESSION['equipeID']."\"/>";?>
		<label>Heure de réalisation</label><br/>
		<input type="time" name="heure" required="required" value="01:00"/><br/>
		<label>Jour de réalisation</label><br/>
		<select name="jour[]" multiple size="5" required="required"/><br/>
			<option value="Lundi">Lundi</option>
			<option value="Mardi">Mardi</option>
			<option value="Mercredi">Mercredi</option>
			<option value="Jeudi">Jeudi</option>
			<option value="Vendredi">Vendredi</option>
			<option value="Samedi">Samedi</option>
			<option value="Dimanche">Dimanche</option>
		</select><br/>
		<label>Lancer les jours fériés ?</label><br/>
		<input type="checkbox" name="ferie"></input></br>
		<input type="submit" value="Ajouter"></input>
	</form>
</body>
</html>
