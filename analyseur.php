<?php
	include('pattern/connexion_mysql.php');
	$date = date("Y-m-d");
	$tab_jours = array('Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi');
	$jour = $tab_jours[date('w', mktime(0,0,0,date('m'),date('d'),date('Y')))];	
	$ferie = 0;
	
	$holiday = $bdd->query ("SELECT * FROM day_publicholiday WHERE DayPH_Date =".$date."");
	$holiday->execute();
	if ($holiday->fetch())
	{
		$ferie=1;
	}
	$holiday = null;
	
	if ($ferie = 1)
	{
		$worktodo = $bdd->query("SELECT * FROM scheduled_task WHERE Task_Day LIKE '%".$jour."%' AND Task_PublicHoliday = 1");
		$worktodo->execute();
		while($task=$worktodo->fecth())
		{
			$confirm=$bdd->query("SELECT * FROM work WHERE Work_TaskID = ".$task['Task_ID']." AND Work_DayToRealise =".$date."");
			$confirm->execute();
			if($confirm->fetch())
			{
				$donothing = 1;
			}
			else
			{
				$donothing = 0;
			}
			$confirm = null;
			if ($donothing == 0)
			{
				$creatework = $bdd->query("INSERT INTO work (Work_DayToRealise, Work_TaskID) VALUES (".$date.", ".$task['Task_ID'].")");
				$creatework->execute();
				$creatework = null;
			}		
		}
		$worktodo = null;		
	}
	else 
	{
		$worktodo = $bdd->query("SELECT * FROM scheduled_task WHERE Task_Day LIKE '%".$jour."%'");
		$worktodo->execute();
		while($task=$worktodo->fecth())
		{
			$confirm=$bdd->query("SELECT * FROM work WHERE Work_TaskID = ".$task['Task_ID']." AND Work_DayToRealise =".$date."");
			$confirm->execute();
			if($confirm->fetch())
			{
				$donothing = 1;
			}
			else
			{
				$donothing = 0;
			}
			$confirm = null;
			if ($donothing == 0)
			{
				$creatework = $bdd->query("INSERT INTO work (Work_DayToRealise, Work_TaskID) VALUES (".$date.", ".$task['Task_ID'].")");
				$creatework->execute();
				$creatework = null;
			}			
		}
		$worktodo = null;
	}
	$bdd = null;
?>